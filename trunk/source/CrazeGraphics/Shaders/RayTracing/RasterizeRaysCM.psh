#include "RayTracing/CMSides.incl"

struct PS_OUT
{
	float4 Right : SV_Target0;
	float4 Left : SV_Target1;
	float4 Top : SV_Target2;
	float4 Bot : SV_Target3;
	float4 Front : SV_Target4;
	float4 Back : SV_Target5;
};

float3 parseColor(float v)
{
	uint color = asuint(v);// & 0x00FFFFFF;
	return float3(	(color & 0xFF) / 255.f,
					((color >> 8) & 0xFF) / 255.f,
					((color >> 16) & 0xFF) / 255.f);
}

PS_OUT main(nointerpolation float4 direction : DIRECTION)
{
	PS_OUT output; 
	float3 color = parseColor(direction.w);
	float dynamicity = length(direction.xyz);
	float3 dir = normalize(direction.xyz);

	output.Right =	float4(saturate(dot(CMSides[0], dir)) * color, dynamicity);
	output.Left =	float4(saturate(dot(CMSides[1], dir)) * color, dynamicity);
	output.Top =	float4(saturate(dot(CMSides[2], dir)) * color, dynamicity);
	output.Bot =	float4(saturate(dot(CMSides[3], dir)) * color, dynamicity);
	output.Front =	float4(saturate(dot(CMSides[4], dir)) * color, dynamicity);
	output.Back =	float4(saturate(dot(CMSides[5], dir)) * color, dynamicity);
	//output.Right =	float4(max(0.f, -direction.x) * color, 0.f);
	//output.Left =	float4(max(0.f,  direction.x) * color, 0.f);
	//output.Top =	float4(max(0.f,  direction.y) * color, 0.f);
	//output.Bot =	float4(max(0.f, -direction.y) * color, 0.f);
	//output.Front =	float4(max(0.f,  direction.z) * color, 0.f);
	//output.Back =	float4(max(0.f, -direction.z) * color, 0.f);

	return output;
}